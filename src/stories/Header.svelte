<script lang="ts">
  import './header.css';
  import Button from './Button.svelte';

  import { createEventDispatcher } from 'svelte';
	import { goto } from '$app/navigation';
	import { session } from '$lib/stores/session';

  const dispatch = createEventDispatcher();

  function onLogin(event: MouseEvent) {
    dispatch('login', event);
  }
  function onLogout(event: MouseEvent) {
    dispatch('logout', event);
  }
  function onRegister(event: MouseEvent) {
    dispatch('register', event);
  }
  function onTrggrs(event: MouseEvent) {
    dispatch('trggrs', event);
  }
  function onProfile(event: MouseEvent) {
    dispatch('profile', event);
  }

  $: username = $session.user?.username;
	$: isLoggedIn = $session.token !== null;
</script>

<header>
  <div class="storybook-header">
    <div>
      <svg
        width="112px"
        height="42px"
        viewBox="0 0 400 150"
        version="1.1"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns="http://www.w3.org/2000/svg"
        aria-label="trggr"
        on:click={() => goto('/')}
        on:keypress={(e) => e.key === 'Enter' && (window.location.href = '/')}
        role="presentation"
        aria-roledescription="home"
      >
        <g id="trggr">
          <path
            id="trggr-1"
            d="M333.816 35L360.456 35L360.456 108.44L333.816 108.44L333.816 35Z"
          />
          <path
            id="trggr-2"
            d="M366.504 39.176C368.52 37.256 370.896 35.8879 373.632 35.072C376.368 34.256 379.752 33.848 383.784 33.848L383.784 57.8959C379.464 57.8959 375.936 58.184 373.2 58.7599C370.464 59.3359 368.232 60.344 366.504 61.7839L366.504 39.176Z"
          />
          <path
            id="trggr-3"
            d="M278.92 137.104C274.12 137.104 268.36 136.816 261.64 136.24L253 135.376L253 116.8L272.296 116.8C275.752 116.8 279.112 116.704 282.376 116.512C284.776 116.32 286.528 115.864 287.632 115.144C288.736 114.424 289.432 113.2 289.72 111.472C289.912 109.168 290.008 106.72 290.008 104.128L290.008 34L316.648 34L316.648 99.376C316.648 106.864 316.312 112.744 315.64 117.016C314.968 121.288 313.528 124.864 311.32 127.744C308.824 130.912 305.008 133.264 299.872 134.8C294.736 136.336 287.752 137.104 278.92 137.104L278.92 137.104Z"
          />
          <path
            id="trggr-4"
            d="M270.024 108.008C266.184 108.008 262.92 107.36 260.232 106.064C257.544 104.768 255.336 102.68 253.608 99.8C250.152 94.232 248.424 84.536 248.424 70.712C248.424 56.792 250.152 47.144 253.608 41.768C255.336 39.08 257.544 37.112 260.232 35.864C262.92 34.616 266.184 33.992 270.024 33.992C273.288 33.992 276.072 34.28 278.376 34.856C280.68 35.432 282.792 36.488 284.712 38.024L284.712 56.168L283.128 56.168C281.016 56.168 279.504 56.288 278.592 56.528C277.68 56.768 276.984 57.272 276.504 58.04C276.024 59.096 275.736 60.584 275.64 62.504C275.544 63.848 275.496 66.68 275.496 71C275.496 75.32 275.544 78.152 275.64 79.496C275.736 81.512 276.024 82.976 276.504 83.888C276.984 84.8 277.752 85.352 278.808 85.544C280.152 85.736 281.592 85.832 283.128 85.832L284.712 85.832L284.712 104.12C282.792 105.656 280.728 106.688 278.52 107.216C276.312 107.744 273.48 108.008 270.024 108.008L270.024 108.008Z"
          />
          <path
            id="trggr-5"
            d="M196.44 138.104C191.64 138.104 185.88 137.816 179.16 137.24L170.52 136.376L170.52 117.8L189.816 117.8C193.272 117.8 196.632 117.704 199.896 117.512C202.296 117.32 204.048 116.864 205.152 116.144C206.256 115.424 206.952 114.2 207.24 112.472C207.432 110.168 207.528 107.72 207.528 105.128L207.528 35L234.168 35L234.168 100.376C234.168 107.864 233.832 113.744 233.16 118.016C232.488 122.288 231.048 125.864 228.84 128.744C226.344 131.912 222.528 134.264 217.392 135.8C212.256 137.336 205.272 138.104 196.44 138.104L196.44 138.104Z"
          />
          <path
            id="trggr-6"
            d="M186.792 108.008C182.952 108.008 179.688 107.36 177 106.064C174.312 104.768 172.104 102.68 170.376 99.8C166.92 94.232 165.192 84.536 165.192 70.712C165.192 56.792 166.92 47.144 170.376 41.768C172.104 39.08 174.312 37.112 177 35.864C179.688 34.616 182.952 33.992 186.792 33.992C190.056 33.992 192.84 34.28 195.144 34.856C197.448 35.432 199.56 36.488 201.48 38.024L201.48 56.168L199.896 56.168C197.784 56.168 196.272 56.288 195.36 56.528C194.448 56.768 193.752 57.272 193.272 58.04C192.792 59.096 192.504 60.584 192.408 62.504C192.312 63.848 192.264 66.68 192.264 71C192.264 75.32 192.312 78.152 192.408 79.496C192.504 81.512 192.792 82.976 193.272 83.888C193.752 84.8 194.52 85.352 195.576 85.544C196.92 85.736 198.36 85.832 199.896 85.832L201.48 85.832L201.48 104.12C199.56 105.656 197.496 106.688 195.288 107.216C193.08 107.744 190.248 108.008 186.792 108.008L186.792 108.008Z"
          />
          <path
            id="trggr-7"
            d="M106.872 35L133.512 35L133.512 108.44L106.872 108.44L106.872 35Z"
          />
          <path
            id="trggr-8"
            d="M139.56 39.176C141.576 37.256 143.952 35.8879 146.688 35.072C149.424 34.256 152.808 33.848 156.84 33.848L156.84 57.8959C152.52 57.8959 148.992 58.184 146.256 58.7599C143.52 59.3359 141.288 60.344 139.56 61.7839L139.56 39.176Z"
          />
          <path
            id="trggr-9"
            d="M42.36 38.168L71.16 38.168L71.16 108.44L42.36 108.44L42.36 38.168Z"
          />
          <path
            id="trggr-10"
            d="M16.296 9.36798L97.368 9.36798L97.368 32.408L16.296 32.408L16.296 9.36798Z"
          />
        </g>
      </svg>
    </div>
    <div>
      {#if isLoggedIn}
        <span class="welcome hidden md:inline">
          Welcome, <b>{username}</b>!
        </span>
        <Button size="text" on:click={onTrggrs} label="Trggrs" />
        <Button size="text" on:click={onProfile} label="Profile" />
        <Button size="small" on:click={onLogout} label="Log out" />
      {:else}
        <Button size="small" on:click={onLogin} label="Log in" />
        <Button primary size="small" on:click={onRegister} label="Sign up" />
      {/if}
    </div>
  </div>
</header>
